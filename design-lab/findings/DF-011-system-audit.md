# تقرير تدقيق النظام (System Audit Report)

**التاريخ:** 2025-12-21
**الهدف:** تحليل الفجوة بين "واجهة اتخاذ القرار" الحالية وبين "منطق التايم لاين" الجديد.

## 1. الحالة الراهنة (The Current State)

النظام يعيش حالة **"انفصام تقني"** واضحة:

### أ. الواجهة (Frontend - The Decision Board)
- **النموذج الذهني:** ما زالت تعمل بمنطق "السجل الواحد" (Single Record).
- **الهدف:** إنتاج خطاب واحد في كل مرة.
- **المشكلة:** تخفي القوة الحقيقية للنظام (التاريخ، التكرارات، التعلم) وتجبر المستخدم على مراجعة كل شيء يدوياً.
- **ملاحظة:** مكون `guaranteeHistoryPanel` موجود ولكنه مخفي (`display: none`)، مما يعني أن المستخدم "أعمى" عن تاريخ الضمان أثناء اتخاذ القرار.

### ب. الكود الخلفي (Backend - The Timeline Engine)
- **النموذج الذهني:** متطور جداً! يعمل بنظام (Event Sourcing).
- **الإمكانيات:**
    - `TimelineEventService.php` يسجل كل شيء: `supplier_change`, `status_change`, `extension`, `release`.
    - يحفظ "لقطة كاملة" (Snapshot) للحالة قبل وبعد كل تغيير.
    - يدعم العمليات الجماعية (Bulk Propagation).
- **الخلاصة:** المحرك جاهز وقوي، لكن الهيكل (الواجهة) قديم ولا يستفيد منه.

## 2. الإجابة على أسئلتك الاستراتيجية

| السؤال | الإجابة الصريحة |
| :--- | :--- |
| **هل ما زالت واجهة "اتخاذ القرار" فعّالة؟** | **لا.** هي فعالة لـ "الإدخال" لكنها سيئة لـ "الإدارة". هي تعاملك كمدخل بيانات وليس كمدير للضمان. |
| **هل ما زلت بحاجة لكل الأزرار (حفظ، تالي، سابق)؟** | **لا.** في التصميم المعتمد على التايم لاين، "الفعل" (Action) هو الحفظ. لا حاجة لزر حفظ منفصل. |
| **هل أنت بحاجة لمنطق "الحفظ" الذي يطلق أحداثاً كثيرة؟** | **جزئياً.** أنت بحاجة للأحداث (Events)، لكن يجب أن تطلق بناءً على "قرار محدد" (مثل: اعتمد التمديد) وليس مجرد "حفظ الصفحة". |
| **كيف يمكن استثمار التايم لاين؟** | بجعله هو **واجهة العمل الرئيسية**. بدلاً من قائمة جانبية، يكون التايم لاين هو "العمود الفقري" الذي تخرج منه القرارات. |

## 3. التوصية: المسار الجديد (The New Path)

يجب الانتقال من:
> **"واجهة تعرض بيانات لتعديلها ثم حفظها"**
إلى:
> **"واجهة تعرض قصة (Timeline) لتضيف إليها حدثاً جديداً"**

### التصميم المقترح: `timeline-driven.php`

1.  **المركز:** التايم لاين ليس مجرد سجل، بل هو **أداة التحكم**.
    *   تريد تمديد؟ اضغط "+" في التايم لاين وأضف حدث "تمديد".
    *   تريد تصحيح اسم؟ اضغط على الحدث القديم وصححه، وسينشئ النظام حدث "تصحيح".
2.  **البطاقة (Information Card):** تعرض "الحالة الحالية" فقط (محصلة التايم لاين).
3.  **المعاينة (Preview):** نتيجة حتمية لآخر حدث في التايم لاين.

---

**القرار:** سنبدأ فوراً في بناء تجربة `timeline-driven.php` لتجسيد هذا المفهوم.
