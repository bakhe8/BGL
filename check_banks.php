<?php
/**
 * ÙØ­Øµ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ù†ÙˆÙƒ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
 */

require __DIR__ . '/app/Support/autoload.php';

use App\Support\Database;

$db = Database::connect();

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n";
echo "â•‘              ÙØ­Øµ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ù†ÙˆÙƒ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª              â•‘\n";
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n";

// Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ù†ÙˆÙƒ
$stmt = $db->query("
    SELECT 
        id,
        official_name,
        official_name_en,
        short_code,
        normalized_key
    FROM banks
    ORDER BY id
");

$banks = $stmt->fetchAll(PDO::FETCH_ASSOC);

echo "ğŸ“Š Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¨Ù†ÙˆÙƒ: " . count($banks) . "\n\n";

// ØªØµÙ†ÙŠÙ Ø§Ù„Ø¨Ù†ÙˆÙƒ
$withShortCodeInEnglish = [];
$withoutShortCodeInEnglish = [];
$noEnglishName = [];

foreach ($banks as $bank) {
    $englishName = $bank['official_name_en'] ?? '';
    $shortCode = $bank['short_code'] ?? '';
    
    if (empty($englishName)) {
        $noEnglishName[] = $bank;
    } elseif (!empty($shortCode) && stripos($englishName, $shortCode) !== false) {
        $withShortCodeInEnglish[] = $bank;
    } else {
        $withoutShortCodeInEnglish[] = $bank;
    }
}

echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n";
echo "â”‚ Ø§Ù„ØªØµÙ†ÙŠÙ Ø­Ø³Ø¨ ÙˆØ¬ÙˆØ¯ short_code ÙÙŠ english_name:                  â”‚\n";
echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n";
echo "  âœ“ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ short_code: " . count($withShortCodeInEnglish) . "\n";
echo "  âœ— Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ short_code: " . count($withoutShortCodeInEnglish) . "\n";
echo "  âš  Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù… Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ: " . count($noEnglishName) . "\n\n";

// Ø¹Ø±Ø¶ Ø£Ù…Ø«Ù„Ø© Ù…Ù† ÙƒÙ„ ÙØ¦Ø©
echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n";
echo "â”‚ Ø£Ù…Ø«Ù„Ø©: Ø¨Ù†ÙˆÙƒ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ short_code ÙÙŠ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ          â”‚\n";
echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n";
foreach (array_slice($withShortCodeInEnglish, 0, 5) as $bank) {
    echo "  ID #{$bank['id']}: {$bank['official_name']}\n";
    echo "    English: {$bank['official_name_en']}\n";
    echo "    Short Code: {$bank['short_code']}\n";
    echo "\n";
}

echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n";
echo "â”‚ Ø£Ù…Ø«Ù„Ø©: Ø¨Ù†ÙˆÙƒ Ù„Ø§ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ short_code ÙÙŠ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ       â”‚\n";
echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n";
foreach (array_slice($withoutShortCodeInEnglish, 0, 5) as $bank) {
    echo "  ID #{$bank['id']}: {$bank['official_name']}\n";
    echo "    English: {$bank['official_name_en']}\n";
    echo "    Short Code: " . ($bank['short_code'] ?: 'NULL') . "\n";
    echo "\n";
}

if (!empty($noEnglishName)) {
    echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n";
    echo "â”‚ Ø£Ù…Ø«Ù„Ø©: Ø¨Ù†ÙˆÙƒ Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù… Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ                                  â”‚\n";
    echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n";
    foreach (array_slice($noEnglishName, 0, 5) as $bank) {
        echo "  ID #{$bank['id']}: {$bank['official_name']}\n";
        echo "    English: NULL\n";
        echo "    Short Code: " . ($bank['short_code'] ?: 'NULL') . "\n";
        echo "\n";
    }
}

// ÙØ­Øµ Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©
echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n";
echo "â”‚ ØªØ­Ù„ÙŠÙ„ Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©:                               â”‚\n";
echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n";

$patterns = [
    'short_code ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©' => 0,
    'short_code Ø¨ÙŠÙ† Ø£Ù‚ÙˆØ§Ø³' => 0,
    'short_code ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©' => 0,
    'Ø¨Ø¯ÙˆÙ† short_code' => 0,
];

foreach ($banks as $bank) {
    $englishName = $bank['official_name_en'] ?? '';
    $shortCode = $bank['short_code'] ?? '';
    
    if (empty($englishName) || empty($shortCode)) {
        $patterns['Ø¨Ø¯ÙˆÙ† short_code']++;
        continue;
    }
    
    if (stripos($englishName, $shortCode) === 0) {
        $patterns['short_code ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©']++;
    } elseif (preg_match('/\(' . preg_quote($shortCode, '/') . '\)/i', $englishName)) {
        $patterns['short_code Ø¨ÙŠÙ† Ø£Ù‚ÙˆØ§Ø³']++;
    } elseif (substr(strtoupper($englishName), -strlen($shortCode)) === strtoupper($shortCode)) {
        $patterns['short_code ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©']++;
    } else {
        $patterns['Ø¨Ø¯ÙˆÙ† short_code']++;
    }
}

foreach ($patterns as $pattern => $count) {
    echo "  {$pattern}: {$count}\n";
}

echo "\n";

// ÙØ­Øµ Ø§Ù„ØªÙ†Ø§Ø³Ù‚ Ø¨ÙŠÙ† official_name Ùˆ english_name
echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n";
echo "â”‚ ÙØ­Øµ Ø§Ù„ØªÙ†Ø§Ø³Ù‚ (Ù‡Ù„ official_name ÙŠØ·Ø§Ø¨Ù‚ english_name):             â”‚\n";
echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n";

$consistentCount = 0;
$inconsistentExamples = [];

foreach ($banks as $bank) {
    if (empty($bank['official_name_en'])) continue;
    
    // Ø¥Ø²Ø§Ù„Ø© short_code Ù…Ù† english_name Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø©
    $cleanEnglish = preg_replace('/\s*\([A-Z]+\)\s*/', '', $bank['official_name_en']);
    $cleanEnglish = trim($cleanEnglish);
    
    // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ (ØªÙ‚Ø±ÙŠØ¨ÙŠ)
    $arabicName = $bank['official_name'];
    
    // ÙØ­Øµ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ ÙŠØ¨Ø¯Ùˆ ÙƒØ£Ù†Ù‡ ØªØ±Ø¬Ù…Ø© Ù…Ø¹Ù‚ÙˆÙ„Ø©
    // (Ù‡Ø°Ø§ ÙØ­Øµ Ø¨Ø³ÙŠØ· - ØµØ¹Ø¨ Ø§Ù„ØªØ£ÙƒØ¯ Ø¨Ø¯Ù‚Ø©)
    $wordsInEnglish = str_word_count($cleanEnglish);
    $wordsInArabic = str_word_count($arabicName);
    
    if (abs($wordsInEnglish - $wordsInArabic) <= 2) {
        $consistentCount++;
    } else {
        if (count($inconsistentExamples) < 3) {
            $inconsistentExamples[] = $bank;
        }
    }
}

echo "  Ù…ØªÙ†Ø§Ø³Ù‚Ø© ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹: {$consistentCount} Ù…Ù† " . count($banks) . "\n\n";

if (!empty($inconsistentExamples)) {
    echo "  Ø£Ù…Ø«Ù„Ø© Ø¹Ù„Ù‰ Ø¹Ø¯Ù… Ø§Ù„ØªÙ†Ø§Ø³Ù‚:\n";
    foreach ($inconsistentExamples as $bank) {
        echo "    - {$bank['official_name']}\n";
        echo "      â†’ {$bank['official_name_en']}\n";
    }
}

echo "\n";
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n";
echo "â•‘                      Ø§Ù„Ø®Ù„Ø§ØµØ© ÙˆØ§Ù„ØªÙˆØµÙŠØ§Øª                        â•‘\n";
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n";

echo "Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ù…Ø­ØªÙ…Ù„ Ù„Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØ³Ø§Ù‚:\n";
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n";
echo "1. Ø¨Ø¹Ø¶ Ø§Ù„Ø¨Ù†ÙˆÙƒ ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯Ù‡Ø§ Ù…Ù† Ù…ØµØ§Ø¯Ø± Ù…Ø®ØªÙ„ÙØ©\n";
echo "2. Ø¨Ø¹Ø¶Ù‡Ø§ Ø£ÙØ¶ÙŠÙ ÙŠØ¯ÙˆÙŠØ§Ù‹ Ø¨ØµÙŠØºØ© Ù…Ø¹ÙŠÙ†Ø© ÙˆØ§Ù„Ø¨Ø¹Ø¶ Ø§Ù„Ø¢Ø®Ø± Ø¨ØµÙŠØºØ© Ù…Ø®ØªÙ„ÙØ©\n";
echo "3. Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ù…Ø¹ÙŠØ§Ø± Ù…ÙˆØ­Ø¯ Ù„ÙƒÙŠÙÙŠØ© ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ\n\n";

echo "Ø§Ù„ØªÙˆØµÙŠØ©:\n";
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n";
echo "ÙŠÙ…ÙƒÙ† ØªÙˆØ­ÙŠØ¯ Ø§Ù„ØµÙŠØºØ© Ø¨Ø­ÙŠØ«:\n";
echo "  - Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ (english_name) = Ø§Ù„ØªØ±Ø¬Ù…Ø© ÙÙ‚Ø·\n";
echo "  - Ø§Ù„Ù€ short_code ÙŠÙØ­ÙØ¸ ÙÙŠ Ø¹Ù…ÙˆØ¯ Ù…Ù†ÙØµÙ„\n";
echo "  - Ø¹Ù†Ø¯ Ø§Ù„Ø¹Ø±Ø¶: ÙŠÙØ¯Ù…Ø¬ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±\n\n";
