<!doctype html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>السجلات</title>
  <link rel="stylesheet" href="/assets/css/style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Tajawal:wght@400;500;700&display=swap"
    rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Tajawal', 'sans-serif'],
            mono: ['Inter', 'monospace'],
          },
          colors: {
            primary: '#2563eb',
            'primary-soft': '#dbeafe',
          }
        }
      }
    }
  </script>
  <style>
    /* Compact Layout */
    tr.inline-panel-row td {
      background-color: #f8fafc;
      padding: 0 !important;
      border-top: 1px solid #e2e8f0;
      border-bottom: 2px solid var(--color-primary-soft);
    }

    .review-panel-compact {
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .panel-header {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .badge-lg {
      background: #fff;
      border: 1px solid #cbd5e1;
      padding: 4px 10px;
      border-radius: 6px;
      font-weight: 700;
      font-family: monospace;
      font-size: 1.1em;
      color: var(--color-text);
    }

    .badge-lg.money {
      color: #059669;
      border-color: #86efac;
      background: #f0fdf4;
    }

    .badged-meta {
      color: #64748b;
      font-size: 0.85em;
      margin-right: auto;
    }

    .review-grid {
      display: grid;
      grid-template-columns: 260px 1fr;
      gap: 32px;
      align-items: start;
    }

    .col-source {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .val-group label {
      font-size: 0.75em;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: #94a3b8;
      margin-bottom: 4px;
      display: block;
    }

    .val-box {
      background: #fff;
      border: 1px dashed #cbd5e1;
      padding: 8px;
      border-radius: 6px;
      color: #475569;
      font-size: 0.9em;
      word-break: break-word;
    }

    .col-decision {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    /* Combobox Styles */
    .autocomplete-wrapper {
      position: relative;
      width: 100%;
      max-width: 500px;
    }

    .autocomplete-input {
      width: 100%;
      padding: 10px 12px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 1em;
      transition: all 0.2s;
    }

    .autocomplete-input:focus {
      border-color: var(--color-primary);
      outline: none;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .autocomplete-list {
      position: absolute;
      top: 100%;
      right: 0;
      left: 0;
      z-index: 100;
      background: #fff;
      border: 1px solid #cbd5e1;
      border-top: none;
      border-radius: 0 0 8px 8px;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      max-height: 300px;
      overflow-y: auto;
      display: none;
      margin-top: 4px;
    }

    .autocomplete-list.open {
      display: block;
    }

    .suggestion-item {
      padding: 10px 12px;
      border-bottom: 1px solid #f1f5f9;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: background 0.1s;
    }

    .suggestion-item:last-child {
      border-bottom: none;
    }

    .suggestion-item:hover,
    .suggestion-item.focused {
      background: #f0f9ff;
    }

    .suggestion-item.is-exact {
      background: #f0fdf4;
    }

    .sug-left {
      display: flex;
      flex-direction: column;
    }

    .sug-name {
      font-weight: 600;
      color: #1e293b;
    }

    .sug-meta {
      font-size: 0.75em;
      color: #64748b;
      margin-top: 2px;
    }

    .sug-score {
      font-size: 0.8em;
      font-weight: 700;
      color: #0369a1;
      background: #e0f2fe;
      padding: 2px 6px;
      border-radius: 99px;
    }

    .panel-footer {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: 12px;
      margin-top: 8px;
    }

    .decision-msg {
      font-size: 0.9em;
      transition: all 0.3s;
    }
  </style>
</head>

<body class="app-shell">
  <header class="app-header">
    <div class="app-header-inner">
      <div>
        <span class="app-logo">BL</span>
        <span class="app-title">نظام إدارة خطابات الضمان</span>
      </div>
      <nav class="app-nav">
        <a href="/" class="app-nav-link is-active">الرئيسية</a>
        <a href="/decision" class="app-nav-link">اتخاذ القرار</a>
        <a href="/settings" class="app-nav-link">الإعدادات</a>
      </nav>
    </div>
  </header>

  <main class="app-main">
    <div class="app-container">
      <section class="page-header">
        <div class="page-header-main">
          <h1 class="page-title">لوحة التحكم بالسجلات</h1>
          <p class="page-subtitle">عرض الحالة والحقول الأساسية لكل الضمانات المستوردة.</p>
        </div>
        <div class="page-actions">
          <a href="/decision" class="btn btn-primary"
            style="background: linear-gradient(135deg, #10b981, #059669); margin-left: 8px;">
            ✓ اتخاذ القرارات
          </a>
          <button class="btn btn-primary" id="btnToggleImport">استيراد ملف</button>
        </div>
      </section>

      <section class="card" id="importCard" style="display:none;">
        <div class="card-header">
          <div>
            <p class="card-title">استيراد ملف Excel</p>
            <p class="card-subtitle">الملفات المدعومة: XLSX. اكتشاف الأعمدة تلقائيًا.</p>
          </div>
        </div>
        <div class="card-body">
          <form id="uploadForm" class="form-grid" style="grid-template-columns: 1fr;">
            <div class="form-group">
              <label class="form-label">اختر الملف</label>
              <input type="file" id="fileInput" accept=".xlsx" class="form-control" />
              <div class="form-help">الحجم المقترح: حتى 10MB</div>
            </div>
            <div class="flex items-center gap-sm">
              <button type="submit" class="btn btn-primary">رفع ومعالجة</button>
              <span id="uploadMsg" class="muted"></span>
            </div>
          </form>
          <div id="uploadError" class="alert alert-danger" style="display:none;"></div>
          <div id="detectedCols" class="alert alert-warning" style="display:none; margin-top:10px;"></div>
        </div>
      </section>

      <section class="card">
        <div class="card-header">
          <div>
            <p class="card-title">تصفية وفرز</p>
            <p class="card-subtitle">اختر الحالة وشاهد الإحصاءات.</p>
          </div>
          <div class="card-actions items-end">
            <div class="form-group" style="min-width:160px;">
              <label class="form-label">تصفية الحالة</label>
              <select id="statusFilter" class="select">
                <option value="all">الكل</option>
                <option value="needs_review">يحتاج مراجعة</option>
                <option value="ready">جاهز</option>
                <option value="completed">مكتمل (معتمد/مرفوض)</option>
              </select>
            </div>
            <div class="form-group" style="min-width:160px;">
              <label class="form-label">رقم جلسة الاستيراد</label>
              <input id="sessionFilter" class="input" type="number" min="1" placeholder="مثال: 115">
            </div>
            <button id="refreshBtn" class="btn btn-primary">تحديث</button>
            <button id="btnRecalcAll" class="btn btn-subtle">إعادة مطابقة الكل</button>
          </div>
        </div>
        <div class="card-body" id="paginationInfo" class="text-sm text-gray-500"></div>
      </section>

      <section class="card">
        <div class="card-header">
          <div>
            <p class="card-title">جميع السجلات</p>
            <p class="card-subtitle">عرض الحالة، الأسماء، والتواريخ الأساسية</p>
          </div>
        </div>
        <div class="table-wrap" style="overflow: visible; max-height: none;">
          <table class="data-table">
            <thead>
              <tr>
                <th data-sort="id" class="cursor-pointer hover:bg-gray-50 rounded-tr-lg">#</th>
                <th data-sort="rawSupplierName" class="cursor-pointer hover:bg-gray-50">المورد</th>
                <th data-sort="rawBankName" class="cursor-pointer hover:bg-gray-50">البنك</th>
                <th data-sort="guaranteeNumber" class="cursor-pointer hover:bg-gray-50">رقم الضمان</th>
                <th data-sort="date" class="cursor-pointer hover:bg-gray-50">التاريخ</th>
                <th data-sort="maxScore" class="cursor-pointer hover:bg-gray-50">المطابقة</th>
                <th class="rounded-tl-lg">الحالة</th>
              </tr>
            </thead>
            <tbody id="tableBody">
              <tr>
                <td colspan="8" class="muted">لا يوجد سجلات بعد.</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

    </div>
  </main>

  <!-- Module Scripts (Order Matters) -->
  <script src="assets/js/shared/api.js?v=182"></script>
  <script src="assets/js/records/state.js?v=182"></script>
  <script src="assets/js/records/table.js?v=182"></script>
  <script src="assets/js/records/autocomplete.js?v=182"></script>
  <!-- inline-edit.js, panel.js, overlay.js archived - see www/assets/js/archive/ -->
  <script src="assets/js/records/init.js?v=182"></script>
</body>

</html>