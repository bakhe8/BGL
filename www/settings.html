<!doctype html>
<!--
═══════════════════════════════════════════════════════════════════════════════
صفحة الإعدادات (Management Console)
═══════════════════════════════════════════════════════════════════════════════
تشمل:
- إعدادات النظام (General)
- إدارة الموردين (Suppliers)
- إدارة البنوك (Banks)
- النسخ الاحتياطي (System)
═══════════════════════════════════════════════════════════════════════════════
-->
<html lang="ar" dir="rtl">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>الإعدادات - نظام خطابات الضمان</title>
  <link rel="stylesheet" href="/assets/css/style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Tajawal:wght@400;500;700&display=swap"
    rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Tajawal', 'sans-serif'],
            mono: ['Inter', 'monospace'],
          },
          colors: {
            primary: '#2563eb',
            'primary-soft': '#dbeafe',
          }
        }
      }
    }
  </script>
  <style>
    /* Tab Styles matching Request */
    .tabs-nav {
      display: flex;
      gap: 1rem;
      border-bottom: 2px solid var(--border-color);
      margin-bottom: 2rem;
    }

    .tab-btn {
      padding: 0.75rem 1.5rem;
      font-weight: bold;
      color: var(--text-muted);
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: all 0.2s;
    }

    .tab-btn:hover {
      color: var(--text-color);
    }

    .tab-btn.active {
      color: var(--primary-color);
      border-bottom-color: var(--primary-color);
    }

    .settings-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
    }

    /* Table Styles */
    .data-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }

    .data-table th {
      text-align: right;
      padding: 0.75rem;
      background: var(--bg-hover);
      border-bottom: 2px solid var(--border-color);
      font-weight: bold;
    }

    .data-table td {
      padding: 0.75rem;
      border-bottom: 1px solid var(--border-color);
    }

    .data-table tr:hover {
      background: var(--bg-hover);
    }

    /* Utility */
    .btn-xs {
      padding: 0.25rem 0.5rem;
      font-size: 0.8rem;
      border-radius: 4px;
      border: 1px solid;
      cursor: pointer;
    }

    .btn-outline-primary {
      color: var(--primary-color);
      border-color: var(--primary-color);
      background: none;
    }

    .btn-outline-danger {
      color: #dc2626;
      border-color: #dc2626;
      background: none;
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      display: none;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: white;
      padding: 2rem;
      border-radius: 8px;
      width: 500px;
      max-width: 90%;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>

<body class="app-shell">
  <header class="app-header">
    <div class="app-header-inner">
      <div>
        <span class="app-logo">BL</span>
        <span class="app-title">نظام إدارة خطابات الضمان</span>
      </div>
      <nav class="app-nav">
        <a href="/" class="app-nav-link">الرئيسية</a>
        <a href="/stats" class="app-nav-link">الإحصائيات</a>
        <a href="/settings" class="app-nav-link is-active">الإعدادات</a>
      </nav>
    </div>
  </header>

  <main class="app-main">
    <div class="app-container">

      <div class="page-header">
        <h1 class="page-title">إدارة النظام</h1>
      </div>

      <!-- Navigation Tabs -->
      <div class="tabs-nav">
        <div class="tab-btn active" data-target="general">الإعدادات العامة</div>
        <div class="tab-btn" data-target="suppliers">إدارة الموردين</div>
        <div class="tab-btn" data-target="banks">إدارة البنوك</div>
        <div class="tab-btn" data-target="system">النسخ الاحتياطي</div>
      </div>

      <!-- Content: General -->
      <div id="general" class="tab-content" style="display: block;">
        <form id="settingsForm">
          <section class="card" style="margin-bottom: 2rem;">
            <div class="card-header">
              <h2 class="card-title">قواعد المطابقة</h2>
            </div>
            <div class="settings-grid">
              <div class="form-group">
                <label class="form-label">نسبة التطابق التلقائي (Auto Match)</label>
                <input type="number" step="0.01" id="autoTh" class="form-control" />
              </div>
              <div class="form-group">
                <label class="form-label">حد المراجعة (Review Threshold)</label>
                <input type="number" step="0.01" id="revTh" class="form-control" />
              </div>
              <div class="form-group">
                <label class="form-label">حد التطابق الضعيف (Weak)</label>
                <input type="number" step="0.01" id="weakTh" class="form-control" />
              </div>
              <div class="form-group">
                <label class="form-label">هامش التعارض (Conflict Delta)</label>
                <input type="number" step="0.01" id="confDelta" class="form-control" />
              </div>
            </div>
          </section>

          <section class="card" style="margin-bottom: 2rem;">
            <div class="card-header">
              <h2 class="card-title">الأوزان (Weights)</h2>
            </div>
            <div class="settings-grid">
              <div class="form-group"><label class="form-label">الاسم الرسمي</label><input type="number" step="0.05"
                  id="wOfficial" class="form-control" /></div>
              <div class="form-group"><label class="form-label">الأسماء البديلة (مؤكدة)</label><input type="number"
                  step="0.05" id="wAltConf" class="form-control" /></div>
              <div class="form-group"><label class="form-label">الأسماء البديلة (تعلم)</label><input type="number"
                  step="0.05" id="wAltLearn" class="form-control" /></div>
              <div class="form-group"><label class="form-label">المطابقة التقريبية (Fuzzy)</label><input type="number"
                  step="0.05" id="wFuzzy" class="form-control" /></div>
            </div>
            <div class="form-group" style="margin-top:1rem;">
              <label class="form-label">عدد الاقتراحات</label>
              <input type="number" id="candLimit" class="form-control" style="width:100px;">
            </div>
          </section>

          <button type="submit" class="btn btn-primary" style="width:100%;">حفظ الإعدادات</button>
        </form>
      </div>

      <!-- Content: Suppliers -->
      <div id="suppliers" class="tab-content" style="display: none;">
        <div class="card">
          <div class="flex justify-between items-center mb-4">
            <input type="text" id="searchSupplier" placeholder="بحث عن مورد..." class="form-control"
              style="max-width:300px;">
            <button class="btn btn-primary" onclick="Settings.Dictionaries.createSupplier()">+ إضافة مورد</button>
          </div>
          <table class="data-table">
            <thead>
              <tr>
                <th>الاسم الرسمي</th>
                <th>الاسم المعياري (Standardized)</th>
                <th>بدائل</th>
                <th>إجراءات</th>
              </tr>
            </thead>
            <tbody id="suppliersTableBody"></tbody>
          </table>
        </div>
      </div>

      <!-- Content: Banks -->
      <div id="banks" class="tab-content" style="display: none;">
        <div class="card">
          <div class="flex justify-between items-center mb-4">
            <input type="text" id="searchBank" placeholder="بحث عن بنك..." class="form-control"
              style="max-width:300px;">
            <button class="btn btn-primary" onclick="Settings.Dictionaries.createBank()">+ إضافة بنك</button>
          </div>
          <table class="data-table">
            <thead>
              <tr>
                <th>الاسم الرسمي</th>
                <th>English Name</th>
                <th>Short Code</th>
                <th>إجراءات</th>
              </tr>
            </thead>
            <tbody id="banksTableBody"></tbody>
          </table>
        </div>
      </div>

      <!-- Content: System (Backup) -->
      <div id="system" class="tab-content" style="display: none;">
        <section class="card">
          <div class="card-header">
            <h2 class="card-title">النسخ الاحتياطي</h2>
          </div>
          <div class="grid margin-top:2rem; gap:1rem;">
            <!-- Existing Backup Logic (re-implemented in JS) -->
            <div class="p-4 bg-gray-50 rounded">
              <h3 class="font-bold mb-2">قاعدة البيانات</h3>
              <button id="btnBackup" class="btn btn-secondary">إنشاء نسخة احتياطية كاملة</button>
            </div>
            <div class="p-4 bg-gray-50 rounded mt-4">
              <h3 class="font-bold mb-2">قاموس البيانات (JSON)</h3>
              <div class="flex gap-2">
                <button id="btnExportDict" class="btn btn-secondary">تصدير القاموس</button>
                <button id="btnImportDict" class="btn btn-secondary">استيراد القاموس</button>
              </div>
            </div>
            <div id="backupMsg" class="mt-4 p-2"></div>
          </div>
        </section>
      </div>

    </div>
  </main>

  <!-- Modals -->
  <div id="supplierModal" class="modal-overlay">
    <div class="modal-content">
      <h2 class="text-xl font-bold mb-4">بيانات المورد</h2>
      <form id="supplierForm">
        <input type="hidden" id="supId">
        <div class="form-group mb-4">
          <label class="form-label">الاسم الرسمي</label>
          <input type="text" id="supName" class="form-control" required>
        </div>

        <div class="form-group mb-4" id="divSupAlts" style="display:none;">
          <label class="form-label">الأسماء البديلة (Aliases)</label>
          <ul id="supAltsList" class="dashed-list" style="padding-right: 1.5rem; color: var(--text-muted);"></ul>
        </div>
        <div class="flex justify-end gap-2 mt-4">
          <button type="button" class="btn btn-secondary"
            onclick="Settings.UI.closeModal('supplierModal')">إلغاء</button>
          <button type="submit" class="btn btn-primary">حفظ</button>
        </div>
      </form>
    </div>
  </div>

  <div id="bankModal" class="modal-overlay">
    <div class="modal-content" style="width:600px;">
      <h2 class="text-xl font-bold mb-4">بيانات البنك</h2>
      <form id="bankForm">
        <input type="hidden" id="bankId">
        <div class="settings-grid mb-4">
          <div class="form-group"><label class="form-label">الاسم بالعربي</label><input type="text" id="bankName"
              class="form-control" required></div>
          <div class="form-group"><label class="form-label">الاسم بالانجليزي</label><input type="text" id="bankNameEn"
              class="form-control"></div>
          <div class="form-group"><label class="form-label">الكود المختصر</label><input type="text" id="bankCode"
              class="form-control"></div>
          <div class="form-group"><label class="form-label">الإدارة (القسم)</label><input type="text" id="bankDept"
              class="form-control"></div>
        </div>
        <h3 class="font-bold mb-2 border-b">العنوان والاتصال</h3>
        <div class="settings-grid mb-4">
          <div class="form-group"><label class="form-label">البريد الالكتروني</label><input type="email" id="bankEmail"
              class="form-control"></div>
          <div class="form-group"><label class="form-label">السطر الأول</label><input type="text" id="bankAddr1"
              class="form-control"></div>
          <div class="form-group"><label class="form-label">السطر الثاني</label><input type="text" id="bankAddr2"
              class="form-control"></div>
        </div>
        <div class="flex justify-end gap-2 mt-4">
          <button type="button" class="btn btn-secondary" onclick="Settings.UI.closeModal('bankModal')">إلغاء</button>
          <button type="submit" class="btn btn-primary">حفظ</button>
        </div>
      </form>
    </div>
  </div>

  </div>
  </div>

  <!-- Custom Confirm Modal (Decision Style) -->
  <div id="confirmModal"
    class="fixed inset-0 bg-black bg-opacity-50 z-[9999] hidden flex items-center justify-center backdrop-blur-sm transition-opacity"
    style="display: none;">
    <div
      class="bg-white rounded-xl shadow-2xl p-6 w-96 max-w-[90%] transform transition-all scale-100 border border-gray-100">
      <h3 class="text-lg font-bold text-gray-800 mb-2 flex items-center gap-2">
        <span class="text-2xl">⚠️</span>
        <span>تأكيد الإجراء</span>
      </h3>
      <p id="confirmMsg" class="text-gray-600 mb-6 text-sm leading-relaxed font-medium">هل أنت متأكد؟</p>
      <div class="flex justify-end gap-3">
        <button id="btnConfirmNo"
          class="px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-100 font-bold transition-colors">إلغاء</button>
        <button id="btnConfirmYes"
          class="px-5 py-2 rounded-lg bg-red-600 text-white hover:bg-red-700 font-bold shadow-lg hover:shadow-xl transition-all border border-red-700">نعم،
          حذف</button>
      </div>
    </div>
  </div>

  <script src="/assets/js/settings.js?v=4" type="module"></script>
</body>

</html>