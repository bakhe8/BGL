# ุชูุฑูุฑ ุชุญููู ุดุงูู - ุงูุณุฌู 12308 ูููุทู ุนุฑุถ ุงูุงูุชุฑุงุญุงุช

## ๐ **ููุฎุต ุชูููุฐู**

### ุงูุญุงูุฉ ุงูุญุงููุฉ:
- **ุงูุณุฌู**: #12308
- **Supplier ID**: 150 โ (ููุฌูุฏ)
- **Supplier Display Name**: NULL โ๏ธ (ูุงุฑุบ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช)
- **Raw Supplier Name**: "ุดุฑูุฉ ููุฏุชุฑูููู ุงูุนุฑุจูุฉ ุงูุณุนูุฏูุฉ"
- **ุงููุทุงุจูุฉ**: 100% ุชุทุงุจู ุชุงู

---

## ๐ **ุงูุชุญููู ุงูููุตู**

### 1. **ูุง ูุญุฏุซ ูู Runtime (ุฃุซูุงุก ุนุฑุถ ุงูุตูุญุฉ)**

```php
// ูู decision-logic.php (ุงูุณุทูุฑ 152-159)
if (!empty($record->supplierId) && empty($record->supplierDisplayName)) {
    // ูููุฃ supplier_display_name ูู ุฌุฏูู suppliers
    $record->supplierDisplayName = "ุดุฑูุฉ ููุฏุชุฑูููู ุงูุนุฑุจูุฉ ุงูุณุนูุฏูุฉ";
}
```

**ุงููุชูุฌุฉ**: 
- `supplier_display_name` ูุชู ููุคู **ููุท ูู ุงูุฐุงูุฑุฉ** (runtime)
- ูุง ูุชู ุงูุญูุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ูุตุจุญ: `raw_name = display_name` (ูุชุทุงุจูุงู ุชูุงูุงู)

---

### 2. **ููุงุฐุง ูุง ุชุธูุฑ ุฑูุงูุฉ "ุงูุงุฎุชูุงุฑ ุงูุญุงูู"ุ**

```php
// ูู decision-logic.php (ุงูุณุทูุฑ 173-175)
$shouldShowSelectionChip = !empty($record->supplierId) &&    // TRUE โ
                           !empty($record->supplierDisplayName) &&  // TRUE โ (ุจุนุฏ ุงูููุก)
                           ($record->supplierDisplayName !== $record->rawSupplierName);  // FALSE โ

// ุงููุชูุฌุฉ: FALSE (ูู ุชุธูุฑ ุงูุฑูุงูุฉ)
```

**ุงูุณุจุจ**: ุงูุงุณูุงู ูุชุทุงุจูุงู ุชูุงูุงูุ ููุง ุญุงุฌุฉ ูุฅุธูุงุฑ "ุงูุงุฎุชูุงุฑ ุงูุญุงูู"

---

### 3. **ููุงุฐุง ูุง ูุธูุฑ "๐ ูู ุงูุงูุณู"ุ**

```php
// ูู decision-page.php (ุงูุณุทูุฑ 348-350)
<?php if (!empty($currentRecord->rawSupplierName) &&                // TRUE โ
          !empty($currentRecord->supplierDisplayName) &&           // TRUE โ
          $currentRecord->rawSupplierName !== $currentRecord->supplierDisplayName): ?>  // FALSE โ
```

**ุงูุณุจุจ**: ููุณ ุงูููุทู - ุงูุงุณูุงู ูุชุทุงุจูุงูุ ููุง ุญุงุฌุฉ ูุฅุธูุงุฑ "ูู ุงูุงูุณู"

---

### 4. **ููุงุฐุง ูุง ุชุธูุฑ ุงูุงูุชุฑุงุญุงุช ูุฒุฑ "ุฅุถุงูุฉ ูููุฑุฏ ุฌุฏูุฏ"ุ**

#### ุฃ. ุงูุงูุชุฑุงุญุงุช (Candidate Chips):
```php
// ููุทู ุนุฑุถ ุงูุฑูุงูุงุช:
foreach ($supplierCandidates as $cand) {
    $isCurrentSelection = ($record->supplierId == $cand['supplier_id']);  // TRUE ููุฃูู
    $score = 100%; // ูุทุงุจูุฉ ุชุงูุฉ
    
    if ($isCurrentSelection && $shouldShowSelectionChip) {
        // ุชูุนุฑุถ ูู "ุงูุงุฎุชูุงุฑ ุงูุญุงูู" - ููู shouldShowSelectionChip = FALSE
        continue; // ูุง ุชูุนุฑุถ!
    }
    
    if ($score >= 99) {
        continue; // ูุง ุชูุนุฑุถ! (ูุทุงุจูุฉ ุชุงูุฉ)
    }
}
```

**ุงููุชูุฌุฉ**: ูุง ุชูุนุฑุถ ุฃู ุฑูุงูุงุช ูุฃู:
1. ุงูุงูุชุฑุงุญ ุงูุฃูู (100%) ูู ููุณู ุงูููุฑุฏ ุงููุฑุจูุท
2. ูุง ููุนุฑุถ ูู "ุงุฎุชูุงุฑ ุญุงูู" ูุฃู ุงูุงุณููู ูุชุทุงุจููู
3. ูุง ููุนุฑุถ ูู candidate ูุฃูู ูุทุงุจูุฉ >= 99%

#### ุจ. ุฒุฑ "ุฅุถุงูุฉ ูููุฑุฏ ุฌุฏูุฏ":
```php
$hasExactMatch = ($score >= 0.99);  // TRUE (100%)

style="<?= $hasExactMatch ? 'display:none;' : '' ?>"  // ูุฎูู!
```

**ุงููุชูุฌุฉ**: ุงูุฒุฑ ูุฎูู ูุฃู ููุงู ูุทุงุจูุฉ 100%

---

## โ **ูู ูุฐุง ุฎุทุฃ ุฃู ุณููู ููุตูุฏุ**

### **ุฅุฌุงุจุฉ: ุณููู ููุตูุฏ ุชูุงูุงู! โ**

**ุงูุณุจุจ**:
1. ุงูููุฑุฏ ููุฌูุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (ID = 150)
2. ุงูุงุณู ูู Excel ูุทุงุจู 100% ููุงุณู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
3. ูุง ุญุงุฌุฉ ูุงูุชุฑุงุญุงุช ุฃู ุฃุฒุฑุงุฑ ุฅุถุงูุฉ
4. ุงููุทุงุจูุฉ ุชุงูุฉ ูุงูุฑุจุท ุตุญูุญ

---

## ๐ **ูุชู ุชุธูุฑ ุงูุงูุชุฑุงุญุงุช ูุงูุฃุฒุฑุงุฑุ**

### ุงูุญุงูุงุช ุงูุชู ุชูุนุฑุถ ูููุง ุงูุงูุชุฑุงุญุงุช:

| ุงูุญุงูุฉ | supplier_id | raw_name vs display_name | ุงููุชูุฌุฉ |
|--------|-------------|-------------------------|---------|
| **ุณุฌู ุฌุฏูุฏ** | NULL | - | โ ุงูุชุฑุงุญุงุช + ุฒุฑ ุฅุถุงูุฉ |
| **ุงุณู ูุฎุชูู** | 150 | ูุฎุชูู (50% ูุทุงุจูุฉ) | โ ุงูุชุฑุงุญุงุช + "ุงูุงุฎุชูุงุฑ ุงูุญุงูู" |
| **ูุทุงุจูุฉ 100%** (ุงูุญุงูุฉ ุงูุญุงููุฉ) | 150 | ูุชุทุงุจู ุชูุงูุงู | โ ูุง ุดูุก (ูู ุดูุก ุตุญูุญ) |

---

## ๐ **ูุชุงุฆุฌ ุงููุญุต ุนูู ุงูุฌูุณุฉ 399**

```
  #12308 | โ๏ธ ID ููุท | supplier_id=150  | display=NO
  #12307 | โ๏ธ ID ููุท | supplier_id=151  | display=NO
  #12306 | โ๏ธ ID ููุท | supplier_id=152  | display=NO
  #12305 | โ๏ธ ID ููุท | supplier_id=146  | display=NO
  #12304 | โ๏ธ ID ููุท | supplier_id=153  | display=NO
  #12303 | โ๏ธ ID ููุท | supplier_id=154  | display=NO
  #12302 | โ๏ธ ID ููุท | supplier_id=14   | display=NO
  #12301 | โ๏ธ ID ููุท | supplier_id=33   | display=NO
  #12300 | โญ ูุงุฑุบ    | supplier_id=NULL | display=NO
  #12299 | โ๏ธ ID ููุท | supplier_id=146  | display=NO
```

### ููุงุญุธุฉ ูููุฉ:
**ุฌููุน ุงูุณุฌูุงุช ุชูุฑูุจุงู ูู ุงูุฌูุณุฉ 399 ุจูุง `supplier_id` ููู ุจุฏูู `supplier_display_name`**

ูุฐุง ูุนูู:
- ูุฐู ุณุฌูุงุช ูู ุงุณุชูุฑุงุฏ ูุฏูู (ูุจู ุชุทุจูู ุงูููุทู ุงูุญุฏูุซ)
- ุฃู ุชู ุฑุจุทูุง automically ุนุจุฑ ูุธุงู ุงููุทุงุจูุฉ ุงูุชููุงุฆูุฉ
- ุงููุธุงู ูููุฃ `display_name` ูู runtime ุจุดูู ุตุญูุญ
- ูู ุดูุก ูุนูู ููุง ูู ูุชููุน

---

## ๐ฏ **ุงูุฎูุงุตุฉ ุงูููุงุฆูุฉ**

### โ **ูุง ููุฌุฏ ุฎุทุฃ ูู ุงูููุฏ!**

ุงูุณููู ุงูุญุงูู:
1. โ **ุตุญูุญ**: ุงููุทุงุจูุฉ 100% ูุง ุชุญุชุงุฌ ุงูุชุฑุงุญุงุช
2. โ **ููุทูู**: ุงูุงุณูุงู ูุชุทุงุจูุงู ููุง ุญุงุฌุฉ ูู "ูู ุงูุงูุณู"
3. โ **ุขูู**: ูุง ูุคุซุฑ ุนูู ุงูุณุฌูุงุช ุงูุฌุฏูุฏุฉ ุฃู ุงููุฏููุฉ
4. โ **ูุนุงู**: ูููุฃ ุงูุจูุงูุงุช ุงููุงูุตุฉ ุชููุงุฆูุงู ูู runtime

### ๐ **ุงูุชูุตูุฉ**

**ูุง ุญุงุฌุฉ ูุฃู ุชุนุฏููุงุช!**

ุงูุณุจุจ:
- ุงููุธุงู ูุนูู ุจุดูู ุตุญูุญ
- ุงูููุทู ุงูุญุงูู ูุญูู ูู ุนุฑุถ ูุนูููุงุช ููุฑุฑุฉ ุฃู ุบูุฑ ุถุฑูุฑูุฉ
- ุงูุณุฌูุงุช ุงููุฏููุฉ ุชูุนุงููุฌ ุจุดูู ุตุญูุญ (runtime display name population)
- ุงูุณุฌูุงุช ุงูุฌุฏูุฏุฉ ุณุชุญูุธ `display_name` ูุจุงุดุฑุฉ ุนูุฏ ุงูุญูุธ

### ๐ง **ููุงุญุธุฉ ุงุฎุชูุงุฑูุฉ (ุชุญุณูู ุงุฎุชูุงุฑู ููุท)**

ุฅุฐุง ุฃุฑุฏุช ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูููุก `supplier_display_name` ููุณุฌูุงุช ุงููุฏููุฉ **ุจุดูู ุฏุงุฆู** (ูุชุญุณูู ุงูุฃุฏุงุก ููููุงู):

```sql
UPDATE imported_records 
SET supplier_display_name = (
    SELECT official_name 
    FROM suppliers 
    WHERE suppliers.id = imported_records.supplier_id
)
WHERE supplier_id IS NOT NULL 
AND supplier_display_name IS NULL;
```

**ููู ูุฐุง ููุณ ุถุฑูุฑูุงู** - ุงูููุทู ุงูุญุงูู ูุนูู ุจุดูู ููุชุงุฒ!

---

## ๐ **ููุงุญุธุงุช ุฅุถุงููุฉ**

### ููุงุฐุง `supplier_display_name` ูุงุฑุบ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุชุ

**ุณููุงุฑูููุงุช ูุญุชููุฉ:**

1. **ุณุฌูุงุช ูู ุงุณุชูุฑุงุฏ ูุฏูู** (ูุจู ุชูุนูู UserDecisionRepository)
2. **ูุทุงุจูุฉ ุชููุงุฆูุฉ** ุนุจุฑ ูุธุงู auto-select (ุงูุณุทูุฑ 203-209)
   - ูุฐุง ุงูููุฏ ูููุฃ ููุท `supplier_id`
   - ูุง ูููุฃ `supplier_display_name` 
   - ูุฐุง **ููุณ ุฎุทุฃ** - ุงูุชุตููู ุงูุญุงูู ูููุฃูุง ูู runtime

3. **ุฅุนุงุฏุฉ ุญุณุงุจ (Recalculate)** 
   - ูุฏ ุชูุญุฏูุซ `supplier_id` ุฏูู `display_name`

### ูู ูุฌุจ ุฅุตูุงุญ Auto-Select ููููุฃ display_nameุ

**ููุณ ุถุฑูุฑูุงู**ุ ููู **ูููู ุชุญุณููู** ุฅุฐุง ุฃุฑุฏุช:

```php
// ุงูุชุญุณูู ุงูุงุฎุชูุงุฑู ูู decision-logic.php
if ($score >= 0.99) {
    $currentRecord->supplierId = $bestSupplier['supplier_id'];
    $currentRecord->supplierDisplayName = $bestSupplier['name'];  // ุฅุถุงูุฉ ูุฐุง ุงูุณุทุฑ
}
```

**ุงููุงุฆุฏุฉ**: 
- ุณูุญูุธ `display_name` ูุจุงุดุฑุฉ ุนูุฏ auto-select ุงูุชุงูู
- ููู **ููุณ ุถุฑูุฑูุงู** - ุงููุธุงู ุงูุญุงูู ูุนูู ุจููุงุกุฉ

---

**ุชุงุฑูุฎ ุงูุชูุฑูุฑ:** 2025-12-18
**ุงูุญุงูุฉ:** โ ูุง ููุฌุฏ ุฎุทุฃ - ุงูุณููู ููุตูุฏ ูููุทูู
**ุงูุชูุตูุฉ:** ุนุฏู ุงูุชุนุฏูู (ุฃู ุชุญุณูู ุงุฎุชูุงุฑู ููุท)
