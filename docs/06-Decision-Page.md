# ØµÙØ­Ø© Ø§ØªØ®Ø§Ø° Ø§Ù„Ù‚Ø±Ø§Ø± (Decision Page)

> **ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡**: 2025-12-13  
> **Ø§Ù„Ù…Ø³Ø§Ø±**: `/decision`  
> **Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©**: `www/decision.html`, `www/assets/js/decision/decision.js`

---

## ğŸ“‹ Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©

ØµÙØ­Ø© Ø§ØªØ®Ø§Ø° Ø§Ù„Ù‚Ø±Ø§Ø± Ù‡ÙŠ ÙˆØ§Ø¬Ù‡Ø© Ù…ÙØ­Ø³Ù‘Ù†Ø© Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø©. ØªØ¹Ø±Ø¶ Ø³Ø¬Ù„Ø§Ù‹ ÙˆØ§Ø­Ø¯Ø§Ù‹ ÙÙŠ ÙƒÙ„ Ù…Ø±Ø© Ù…Ø¹ Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„Ø§Ø®ØªÙŠØ§Ø± Ù„Ù„Ù…ÙˆØ±Ø¯ ÙˆØ§Ù„Ø¨Ù†Ùƒ.

### Ù„Ù…Ø§Ø°Ø§ Ù‡Ø°Ø§ Ø§Ù„ØªØµÙ…ÙŠÙ…ØŸ

| Ø§Ù„Ù…Ø¹ÙŠØ§Ø± | Inline Edit ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ | ØµÙØ­Ø© Ø³Ø¬Ù„ ÙˆØ§Ø­Ø¯ âœ… |
|---------|----------------------|-----------------|
| Ø§Ù„ØªØ¹Ù‚ÙŠØ¯ Ø§Ù„ØªÙ‚Ù†ÙŠ | Ø¹Ø§Ù„ÙŠ (Portal, Z-index) | Ù…Ù†Ø®ÙØ¶ |
| Ø§Ù„Ø£Ø¯Ø§Ø¡ | ÙŠØªØ¯Ù‡ÙˆØ± Ù…Ø¹ 1000+ ØµÙ | Ø«Ø§Ø¨Øª |
| ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… | Ù…Ø±Ø¨ÙƒØ© | ÙˆØ§Ø¶Ø­Ø© ÙˆÙ…Ø±ÙƒØ²Ø© |

---

## ğŸ”§ Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©

### 1. Ø¨Ù†ÙŠØ© Ø§Ù„ØµÙØ­Ø© (`www/decision.html`)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª: Ø¥Ø¬Ù…Ø§Ù„ÙŠ | Ù…Ø¹ØªÙ…Ø¯ | Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Ø§Ù„Ø¨Ù†Ùƒ: [Autocomplete Input]       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Ø§Ù„Ù…ÙˆØ±Ø¯: [Autocomplete] [+ Ø¬Ø¯ÙŠØ¯]   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„ (Ø§Ù„Ù…Ø¨Ù„ØºØŒ Ø§Ù„Ø¶Ù…Ø§Ù†ØŒ Ø§Ù„ØªØ§Ø±ÙŠØ®...)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [â† Ø§Ù„Ø³Ø§Ø¨Ù‚]  [Ø­ÙØ¸ ÙˆØ§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ØªØ§Ù„ÙŠ]  [Ø§Ù„ØªØ§Ù„ÙŠ â†’] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Ù…Ù†Ø·Ù‚ JavaScript (`www/assets/js/decision/decision.js`)

#### Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (State)
```javascript
BGL.Decision = {
    records: [],           // Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª
    currentIndex: 0,       // Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ø­Ø§Ù„ÙŠ
    selectedSupplierId: null,
    selectedBankId: null,
    supplierCandidates: [], // Ù…Ø±Ø´Ø­ÙŠ Ø§Ù„Ù…ÙˆØ±Ø¯ Ù„Ù„Ø³Ø¬Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ
    bankCandidates: [],     // Ù…Ø±Ø´Ø­ÙŠ Ø§Ù„Ø¨Ù†Ùƒ Ù„Ù„Ø³Ø¬Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ
    _pendingNewSupplierName: null  // Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ø¥Ù† ÙˆÙØ¬Ø¯)
};
```

#### Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©

| Ø§Ù„Ø¯Ø§Ù„Ø© | Ø§Ù„ÙˆØµÙ |
|--------|-------|
| `init()` | ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø© ÙˆØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª |
| `_loadData()` | Ø¬Ù„Ø¨ Ø§Ù„Ø³Ø¬Ù„Ø§Øª ÙˆØ§Ù„Ù‚ÙˆØ§Ù…ÙŠØ³ Ù…Ù† Ø§Ù„Ù€ API |
| `_loadCandidates()` | Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø±Ø´Ø­ÙŠÙ† Ù„Ù„Ø³Ø¬Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ |
| `_displayCurrentRecord()` | Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ |
| `_handleSupplierInput()` | Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…ÙˆØ±Ø¯ + ØªÙØ¹ÙŠÙ„ Ø²Ø± "Ø¬Ø¯ÙŠØ¯" |
| `_addNewSupplier()` | Ø¥Ù†Ø´Ø§Ø¡ Ù…ÙˆØ±Ø¯ Ø¬Ø¯ÙŠØ¯ Ø¹Ø¨Ø± API |
| `saveAndNext()` | Ø­ÙØ¸ Ø§Ù„Ù‚Ø±Ø§Ø± ÙˆØ§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ§Ù„ÙŠ |
| `_goToNextPending()` | Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ø£Ù‚Ø±Ø¨ Ø³Ø¬Ù„ Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± |

---

## âœ¨ Ø§Ù„Ù…ÙŠØ²Ø§Øª

### 1. Ø§Ù„ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© (Auto-fill)
- Ø¹Ù†Ø¯ ÙØªØ­ Ø³Ø¬Ù„ØŒ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù„Ù‡ `bankId` Ø£Ùˆ `supplierId` Ù…Ø³Ø¨Ù‚Ø§Ù‹ØŒ ÙŠÙ…Ù„Ø£ Ø§Ù„Ø­Ù‚ÙˆÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
- Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù…Ø±Ø´Ø­ ÙˆØ§Ø­Ø¯ Ø¨ØªØ·Ø§Ø¨Ù‚ Ø¹Ø§Ù„ÙØŒ ÙŠÙØ¹Ø±Ø¶ ÙƒØ§Ù‚ØªØ±Ø§Ø­ Ø£ÙˆÙ„

### 2. Autocomplete Ù„Ù„Ù…ÙˆØ±Ø¯ ÙˆØ§Ù„Ø¨Ù†Ùƒ
- ÙŠØ¬Ù…Ø¹ Ø¨ÙŠÙ† **Ø§Ù„Ù…Ø±Ø´Ø­ÙŠÙ† Ø§Ù„Ø°ÙƒÙŠÙŠÙ†** (Ù…Ù† candidates API) Ùˆ **Ø§Ù„Ù‚Ø§Ù…ÙˆØ³ Ø§Ù„ÙƒØ§Ù…Ù„**
- ÙŠÙØ¸Ù‡Ø± Score Ù„Ù„Ù…Ø±Ø´Ø­ÙŠÙ† Ø§Ù„Ø°ÙƒÙŠÙŠÙ†
- ÙŠØ¯Ø¹Ù… Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„ÙƒØªØ§Ø¨Ø©

### 3. Ø²Ø± "Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ±Ø¯ Ø¬Ø¯ÙŠØ¯" (+ Ø¬Ø¯ÙŠØ¯)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ø§Ù„Ø³Ù„ÙˆÙƒ:                                     â”‚
â”‚ 1. Ù…Ø¹Ø·Ù„ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹                           â”‚
â”‚ 2. ÙŠÙÙØ¹Ù‘Ù„ Ø¹Ù†Ø¯ ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù… â‰¥2 Ø­Ø±Ù Ø¨Ø¯ÙˆÙ† Ù†ØªØ§Ø¦Ø¬  â”‚
â”‚ 3. Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± â†’ POST /api/dictionary/suppliers â”‚
â”‚ 4. Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ â†’ ÙŠØ®ØªØ§Ø± Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Ù†Ø´Ø± Ø§Ù„Ù‚Ø±Ø§Ø± Ø§Ù„ÙÙˆØ±ÙŠ (Instant Propagation)
Ø¹Ù†Ø¯ Ø­ÙØ¸ Ù‚Ø±Ø§Ø±ØŒ ÙŠÙØ·Ø¨Ù‚ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰ **ÙÙŠ Ù†ÙØ³ Ø§Ù„Ø¬Ù„Ø³Ø©** Ø¨Ù†ÙØ³ `rawSupplierName`.

```php
// ÙÙŠ RecordsController.php
$propagatedCount = $this->records->bulkUpdateSupplierByRawName(
    $record->sessionId,
    $record->rawSupplierName,
    $id,  // Ø§Ø³ØªØ«Ù†Ø§Ø¡ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ
    $supplierId,
    $supplierDisplayName
);
```

**Ø§Ù„Ù‚ÙŠÙˆØ¯:**
- ÙÙ‚Ø· Ø¯Ø§Ø®Ù„ Ù†ÙØ³ `session_id` (Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠØ©)
- ÙÙ‚Ø· Ù„Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªÙŠ `supplier_id IS NULL`

---

## ğŸ”„ ØªØ¯ÙÙ‚ Ø§Ù„Ø¹Ù…Ù„

```mermaid
flowchart TD
    A[ÙØªØ­ /decision] --> B[ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª]
    B --> C[Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ø£ÙˆÙ„ pending]
    C --> D[Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„]
    D --> E{Ù‡Ù„ Ø§Ù„Ù…ÙˆØ±Ø¯/Ø§Ù„Ø¨Ù†Ùƒ Ù…Ø­Ø¯Ø¯Ø§Ù†ØŸ}
    E -->|Ù†Ø¹Ù…| F[ØªØ¹Ø¨Ø¦Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©]
    E -->|Ù„Ø§| G[Ø§Ù†ØªØ¸Ø§Ø± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…]
    F --> H[Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ¶ØºØ· Ø­ÙØ¸]
    G --> H
    H --> I[POST /api/records/{id}/decision]
    I --> J[Ù†Ø´Ø± Ù„Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…ØªØ´Ø§Ø¨Ù‡Ø©]
    J --> K[ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ¹Ù„Ù…]
    K --> L[Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ§Ù„ÙŠ]
    L --> D
```

---

## ğŸ“¡ Ù†Ù‚Ø§Ø· Ø§Ù„Ù€ API Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©

| Method | Endpoint | Ø§Ù„ÙˆØµÙ |
|--------|----------|-------|
| GET | `/api/records` | Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª |
| GET | `/api/records/{id}/candidates` | Ø¬Ù„Ø¨ Ù…Ø±Ø´Ø­ÙŠ Ø§Ù„Ù…ÙˆØ±Ø¯ ÙˆØ§Ù„Ø¨Ù†Ùƒ |
| POST | `/api/records/{id}/decision` | Ø­ÙØ¸ Ø§Ù„Ù‚Ø±Ø§Ø± |
| GET | `/api/dictionary/suppliers` | Ø¬Ù„Ø¨ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† |
| GET | `/api/dictionary/banks` | Ø¬Ù„Ø¨ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨Ù†ÙˆÙƒ |
| POST | `/api/dictionary/suppliers` | Ø¥Ù†Ø´Ø§Ø¡ Ù…ÙˆØ±Ø¯ Ø¬Ø¯ÙŠØ¯ |

---

## âŒ¨ï¸ Ø§Ø®ØªØµØ§Ø±Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­

| Ø§Ù„Ù…ÙØªØ§Ø­ | Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ |
|---------|--------|
| `â†` | Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø³Ø§Ø¨Ù‚ |
| `â†’` | Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ§Ù„ÙŠ |
| `Ctrl+S` | Ø­ÙØ¸ ÙˆØ§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ØªØ§Ù„ÙŠ |

---

## ğŸ”— Ø§Ù„Ù…Ù„ÙØ§Øª Ø°Ø§Øª Ø§Ù„ØµÙ„Ø©

- [`www/decision.html`](../www/decision.html) - Ø¨Ù†ÙŠØ© HTML
- [`www/assets/js/decision/decision.js`](../www/assets/js/decision/decision.js) - Ù…Ù†Ø·Ù‚ JavaScript
- [`www/index.php`](../www/index.php) - ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø± `/decision`
- [`app/Controllers/RecordsController.php`](../app/Controllers/RecordsController.php) - Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„Ù†Ø´Ø±
- [`app/Repositories/ImportedRecordRepository.php`](../app/Repositories/ImportedRecordRepository.php) - Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ
