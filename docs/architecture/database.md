# ุชุตููู ูุงุนุฏุฉ ุงูุจูุงูุงุช (Database Design)

ูุณุชุฎุฏู ุงููุธุงู ูุงุนุฏุฉ ุจูุงูุงุช **SQLite 3** ูุฏูุฌุฉ. ุชู ุงุฎุชูุงุฑูุง ูุณูููุฉ ุงูููู (Portability) ูุนุฏู ุงูุญุงุฌุฉ ูุฅุนุฏุงุฏ ุฎุงุฏู ูุนูุฏุ ููุง ูุชูุงุณุจ ูุน ุทุจูุนุฉ ุงูุชุทุจูู (Local Self-Hosted).

## ๐๏ธ ุงูุฌุฏุงูู ุงูุฑุฆูุณูุฉ (Main Tables)

### `imported_records`
ุงูุฌุฏูู ุงููุญูุฑู ุงูุฐู ูุญูู ูุงูุฉ ุจูุงูุงุช ุงูุถูุงูุงุช.

| ุงูุนููุฏ | ุงูููุน | ุงููุตู |
|--------|-------|-------|
| `id` | INTEGER PK | ุงููุนุฑู ุงููุฑูุฏ |
| `session_id` | INTEGER | ุฑูู ุฌูุณุฉ ุงูุงุณุชูุฑุงุฏ (ููุชุฌููุน) |
| `guarantee_number` | TEXT | ุฑูู ุงูุถูุงู (ูููุฑุณ) |
| `raw_supplier_name` | TEXT | ุงุณู ุงูููุฑุฏ ููุง ุฌุงุก ูู ุงููุตุฏุฑ |
| `supplier_id` | INTEGER | ูุนุฑู ุงูููุฑุฏ ุงููุนุชูุฏ (Foreign Key) |
| `match_status` | TEXT | ุญุงูุฉ ุงูุณุฌู (pending, ready, ...) |
| `snapshot_data` | TEXT | (Legacy) ูุฏููุ ุงูุชูู ูุฌุฏูู Timeline |

### `guarantee_timeline_events` โญ
ุณุฌู ุงูุฃุญุฏุงุซ ุงูุชุงุฑูุฎูุฉ (Audit Trail).

| ุงูุนููุฏ | ุงูููุน | ุงููุตู |
|--------|-------|-------|
| `id` | INTEGER PK | ุงููุนุฑู |
| `guarantee_number` | TEXT | ุฑูู ุงูุถูุงู ุงููุฑุชุจุท |
| `event_type` | TEXT | ููุน ุงูุญุฏุซ (import, match, release...) |
| `snapshot_data` | TEXT | ูุณุฎุฉ JSON ูุงููุฉ ููุณุฌู ูุญุธุฉ ุงูุญุฏุซ |
| `created_at` | DATETIME | ููุช ุงูุญุฏุซ |

### `supplier_suggestions` (Learning)
ุฌุฏูู ุงูุชุนูู "ุงููุงุด" ุงูุฐู ูุญูุธ ุงูุงูุชุฑุงุญุงุช ุงููุญุณูุจุฉ ูุณุจูุงู.

| ุงูุนููุฏ | ุงูููุน | ุงููุตู |
|--------|-------|-------|
| `normalized_input` | TEXT | ุงูุงุณู ุงูุฎุงู ุจุนุฏ ุงูุชุทุจูุน (ููุชุงุญ ุงูุจุญุซ) |
| `supplier_id` | INTEGER | ุงูููุฑุฏ ุงูููุชุฑุญ |
| `source` | TEXT | ูุตุฏุฑ ุงูุงูุชุฑุงุญ (learning, history...) |
| `total_score` | INTEGER | ูุฌููุน ููุงุท ุงูุซูุฉ |
| `usage_count` | INTEGER | ุนุฏุฏ ูุฑุงุช ุงุณุชุฎุฏุงู ูุฐุง ุงูุงูุชุฑุงุญ |
| `block_count` | INTEGER | ุนุฏุฏ ูุฑุงุช ุญุธุฑ ูุฐุง ุงูุงูุชุฑุงุญ |

---

## ๐ ุฌุฏุงูู ุงูููุงููุณ (Dictionaries)

### `suppliers`
ูุงุฆูุฉ ุงูููุฑุฏูู ุงููุนุชูุฏูู.
*   `official_name`: ุงูุงุณู ุงูุฑุณูู (ูุธูุฑ ูู ุงูุฎุทุงุจุงุช).
*   `normalized_name`: ุงูุงุณู ููุจุญุซ ูุงูููุงุฑูุฉ.

### `banks`
ูุงุฆูุฉ ุงูุจููู ุงููุนุชูุฏุฉ.
*   `official_name_ar`: ุงูุงุณู ุงูุฑุณูู ุจุงูุนุฑุจู.
*   `short_code`: ุงูุฑูุฒ ุงููุฎุชุตุฑ (e.g., SNB).

---

## ๐ ุงูุนูุงูุงุช (Relationships)

```mermaid
erDiagram
    IMPORT_SESSIONS ||--|{ IMPORTED_RECORDS : contains
    IMPORTED_RECORDS }o--|| SUPPLIERS : matches
    IMPORTED_RECORDS }o--|| BANKS : matches
    IMPORTED_RECORDS ||--|{ TIMELINE_EVENTS : history
    
    SUPPLIERS ||--|{ SUPPLIER_SUGGESTIONS : suggested_as
```

---

## ๐ ููุงุญุธุงุช ูููุทูุฑูู

1.  **SQLite Constraints**: ูุงุนุฏุฉ ุงูุจูุงูุงุช ุชุฏุนู ุงูุนูุงูุงุช (Foreign Keys) ููููุง ูุนุทูุฉ ุงูุชุฑุงุถูุงู ูู ุจุนุถ ุงููุณุฎ ุงููุฏููุฉ. ุงููุธุงู ูุฏูุฑ ุงูุชูุงูู (Integrity) ุจุฑูุฌูุงู ูู ุงูุบุงูุจ.
2.  **Indexing**: ุงูุญููู ุงููุณุชุฎุฏูุฉ ูู ุงูุจุญุซ (`guarantee_number`, `normalized_input`) ูููุฑุณุฉ ูุถูุงู ุณุฑุนุฉ ุงูุฃุฏุงุก.
3.  **JSON Storage**: ูุณุชุฎุฏู ุฃุนูุฏุฉ TEXT ูุชุฎุฒูู JSON (ูุซู `snapshot_data`) ูุฃู SQLite ูุฑูุฉ ุฌุฏุงู ูู ุงูุชุนุงูู ูุน ุงููุตูุต ุงูุทูููุฉ.
