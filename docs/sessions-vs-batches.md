# ุงููุฑู ุจูู Sessions ู Batches

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุงููุธุงู ูุณุชุฎุฏู **ููููููู ูููุตููู** ูุชูุธูู ุงูุจูุงูุงุช:

1. **Sessions (ุงูุฌูุณุงุช)** - ูุชุฌููุน **ุงูุฅุฌุฑุงุกุงุช** (actions)
2. **Batches (ุงููุฌููุนุงุช)** - ูุชุฌููุน **ุงูุงุณุชูุฑุงุฏุงุช** (imports)

> โ๏ธ **ููู ุฌุฏุงู:** ูุฐุงู ุงููููููุงู **ูุณุชููุงู ุชูุงูุงู** ููุง ูุชุฏุงุฎูุงู!

---

## ๐ฏ ุงูุฌูุณุงุช (Sessions)

### ุงููุฏู
ุชุฌููุน **ุงูุฅุฌุฑุงุกุงุช ุงูููููุฉ** (ุชูุฏูุฏุ ุฅูุฑุงุฌุ ุชุนุฏูู) ุงูุชู ุชุชู ุนูู ุงูุถูุงูุงุช.

### ุงูุฌุฏูู
```sql
CREATE TABLE import_sessions (
    id INTEGER PRIMARY KEY,
    session_type TEXT NOT NULL,    -- ููุน ุงูุฌูุณุฉ
    record_count INTEGER,           -- ุนุฏุฏ ุงูุณุฌูุงุช
    created_at DATETIME
);
```

### ุฃููุงุน ุงูุฌูุณุงุช
| ุงูููุน | ุงููุตู | ูุชู ุชููุดุฃ |
|-------|-------|----------|
| `daily_actions` | ุฌูุณุฉ ุฅุฌุฑุงุกุงุช ููููุฉ | ูุฑุฉ ูุงุญุฏุฉ ูู ุงูููู (ุชููุงุฆูุงู) |
| ~~`extension_action`~~ | **ูุฏูู - ูุง ุชุณุชุฎุฏู** | - |
| ~~`release_action`~~ | **ูุฏูู - ูุง ุชุณุชุฎุฏู** | - |

### ููููุฉ ุงูุงุณุชุฎุฏุงู

#### โ ุงูุทุฑููุฉ ุงูุตุญูุญุฉ (ุฌูุณุฉ ููููุฉ)
```php
use App\Repositories\ImportSessionRepository;

$sessionRepo = new ImportSessionRepository();

// ุงูุญุตูู ุนูู ุฌูุณุฉ ุงูููู (ุฃู ุฅูุดุงุก ูุงุญุฏุฉ ุฌุฏูุฏุฉ)
$session = $sessionRepo->getOrCreateDailySession('daily_actions');

// ุฅูุดุงุก ุฅุฌุฑุงุก (ุชูุฏูุฏ/ุฅูุฑุงุฌ)
$record = ImportedRecordRepository::create([
    'session_id' => $session->id,        // โ ุงูุฌูุณุฉ ุงูููููุฉ
    'record_type' => 'extension_action',
    'guarantee_number' => 'B123456',
    // ...
]);
```

#### โ ุงูุทุฑููุฉ ุงููุฏููุฉ (ูุง ุชุณุชุฎุฏู)
```php
// โ ุฎุทุฃ: ุฌูุณุฉ ูููุตูุฉ ููู ุฅุฌุฑุงุก
$session = $sessionRepo->create('extension_action');
```

### ุงูููุงุฆุฏ
- โ **ุชูุธูู ูููู ูุงุถุญ** - ูู ุฅุฌุฑุงุกุงุช ุงูููู ูู ุฌูุณุฉ ูุงุญุฏุฉ
- โ **ุชูููู ุนุฏุฏ ุงูุฌูุณุงุช** - ุฌูุณุฉ ูุงุญุฏุฉ ุจุฏูุงู ูู ูุฆุงุช
- โ **ุณูุงู ุฃูุถู** - ุงูุชููู ุจูู ุฅุฌุฑุงุกุงุช ููุณ ุงูููู ุณูู
- โ **Audit trail** - ุณุฌู ูุงุถุญ ููู ููู ุนูู

### ูุซุงู ุนููู
```
ุงูููู: 2025-12-20

ุงูุฅุฌุฑุงุกุงุช:
- 09:00 AM: ุชูุฏูุฏ ุถูุงู B123456
- 10:30 AM: ุฅูุฑุงุฌ ุนู ุถูุงู G789012
- 02:15 PM: ุชูุฏูุฏ ุถูุงู A456789
- 03:45 PM: ุฅูุฑุงุฌ ุนู ุถูุงู C234567

ุงููุชูุฌุฉ:
โ Session #500 (daily_actions)
  - Record count: 4
  - ุงูุชููู: "Record 1 of 4"
```

---

## ๐ฆ ุงููุฌููุนุงุช (Batches)

### ุงููุฏู
ุชุฌููุน **ุงูุจูุงูุงุช ุงููุณุชูุฑุฏุฉ** ูู ูุตุงุฏุฑ ุฎุงุฑุฌูุฉ (Excelุ ุฅุฏุฎุงู ูุฏููุ ูุตู).

### ุงูุฌุฏูู
```sql
CREATE TABLE import_batches (
    id INTEGER PRIMARY KEY,
    batch_type TEXT NOT NULL,      -- ููุน ุงููุฌููุนุฉ
    description TEXT,               -- ูุตู
    filename TEXT,                  -- ุงุณู ุงูููู (ููู Excel)
    total_records INTEGER,          -- ุฅุฌูุงูู ุงูุณุฌูุงุช
    ready_records INTEGER,          -- ุงูุณุฌูุงุช ุงูุฌุงูุฒุฉ
    created_at DATETIME
);
```

### ุฃููุงุน ุงููุฌููุนุงุช
| ุงูููุน | ุงููุตู | ูุชู ุชููุดุฃ |
|-------|-------|----------|
| `excel_import` | ุงุณุชูุฑุงุฏ ููู Excel | ููู ููู Excel ูุณุชูู |
| `manual_batch` | ุฅุฏุฎุงู ูุฏูู | ูุฑุฉ ูุงุญุฏุฉ ูู ุงูููู (ุชููุงุฆูุงู) |
| `text_paste` | ูุตู ูุต ูุจุงุดุฑ | ูุฑุฉ ูุงุญุฏุฉ ูู ุงูููู (ุชููุงุฆูุงู) |

### ููููุฉ ุงูุงุณุชุฎุฏุงู

#### Excel Import
```php
use App\Repositories\ImportBatchRepository;
use App\Repositories\GuaranteeRepository;

$batchRepo = new ImportBatchRepository();

// ุฅูุดุงุก batch ุฌุฏูุฏ ูููู Excel
$batchId = $batchRepo->create([
    'batch_type' => 'excel_import',
    'filename' => 'guarantees_2025.xlsx',
    'description' => 'ุงุณุชูุฑุงุฏ ุฏูุณูุจุฑ 2025'
]);

// ุญูุธ ุงูุณุฌูุงุช
foreach ($rows as $row) {
    GuaranteeRepository::create([
        'import_batch_id' => $batchId,  // โ ุงููุฌููุนุฉ
        'guarantee_number' => $row['guarantee_no'],
        // ...
    ]);
}
```

#### Manual Entry (ูููู)
```php
// ุงูุญุตูู ุนูู batch ุงูููู ุฃู ุฅูุดุงุก ูุงุญุฏ ุฌุฏูุฏ
$batchId = $batchRepo->getOrCreateDailyManualBatch();

GuaranteeRepository::create([
    'import_batch_id' => $batchId,
    // ...
]);
```

#### Text Paste (ูููู)
```php
// ุงูุญุตูู ุนูู batch ุงูููู ุฃู ุฅูุดุงุก ูุงุญุฏ ุฌุฏูุฏ
$batchId = $batchRepo->getOrCreateDailyPasteBatch();

GuaranteeRepository::create([
    'import_batch_id' => $batchId,
    // ...
]);
```

### ุงูููุงุฆุฏ
- โ **ุชุชุจุน ุงููุตุฏุฑ** - ูุนุฑูุฉ ูู ุฃูู ุฌุงุกุช ุงูุจูุงูุงุช
- โ **ุงูุชุญุฏูุซ ุงูุฌูุงุนู** - ุชุญุฏูุซ ูู ุณุฌูุงุช ููุณ ุงูู batch ูุนุงู
- โ **ุฅุญุตุงุฆูุงุช ุฏูููุฉ** - ุนุฏุฏ ุงูุณุฌูุงุช ุงูุฌุงูุฒุฉ vs ุงููุญุชุงุฌุฉ ูุฑุงุฑ
- โ **ุณูููุฉ ุงูุจุญุซ** - ุนุฑุถ ูู ุณุฌูุงุช ููู ูุนูู

### ูุซุงู ุนููู
```
ุงูููู: 2025-12-20

ุงููุฌููุนุงุช:
- Batch #100: excel_import (guarantees_dec.xlsx) - 150 ุณุฌู
- Batch #101: manual_batch (ุฅุฏุฎุงู ูุฏูู - 2025-12-20) - 5 ุณุฌูุงุช
- Batch #102: text_paste (ูุตู ูุจุงุดุฑ - 2025-12-20) - 12 ุณุฌู

ูู batch ูููุตู ููุณุชูู!
```

---

## ๐ ุงูููุงุฑูุฉ ุงูุดุงููุฉ

| ุงููุนูุงุฑ | Sessions | Batches |
|---------|----------|---------|
| **ุงููุฏู ุงูุฑุฆูุณู** | ุชุฌููุน ุฅุฌุฑุงุกุงุช ููููุฉ | ุชุฌููุน ุงุณุชูุฑุงุฏุงุช |
| **ุงููุตุฏุฑ** | ุฏุงุฎู ุงููุธุงู (actions) | ุฎุงุฑุฌ ุงููุธุงู (imports) |
| **ุงูุชูุฑุงุฑ** | ูููู (ุฌูุณุฉ ูุงุญุฏุฉ/ููู) | ุญุณุจ ุงูุญุงุฌุฉ (Excel) ุฃู ูููู (manual/paste) |
| **ุงูุฑุจุท** | `imported_records.session_id` | `guarantees.import_batch_id` |
| **ุงูุนุฏุฏ ุงููุชููุน** | ูููู (~365/ุณูุฉ) | ูุชูุณุท (~100s/ุณูุฉ) |
| **ุงููุงุจููุฉ ููุชุนุฏูู** | ูุงุฏุฑุงู (audit) | ูุนู (ูุจู ุงูุฅููุงู) |
| **ุงูุงุณุชุฎุฏุงู ูู UI** | Decision page navigation | Import tracking & reporting |

---

## โ๏ธ ุฃุฎุทุงุก ุดุงุฆุนุฉ ูุฌุจ ุชุฌูุจูุง

### โ ุฎุทุฃ 1: ุงูุฎูุท ุจูู Session ู Batch
```php
// โ ุฎุทุฃ
$session = createSession();
$guarantee = create(['import_batch_id' => $session->id]); // ุฎุทุฃ ูู ุงูููุน!
```

```php
// โ ุตุญูุญ
$session = getOrCreateDailySession();
$importedRecord = create(['session_id' => $session->id]);

$batch = createBatch();
$guarantee = create(['import_batch_id' => $batch]);
```

### โ ุฎุทุฃ 2: ุฅูุดุงุก session ุฌุฏูุฏ ููู ุฅุฌุฑุงุก
```php
// โ ุฎุทุฃ (ูุฏูู)
foreach ($actions as $action) {
    $session = createSession('extension_action'); // ุฌูุณุฉ ุฌุฏูุฏุฉ!
}
```

```php
// โ ุตุญูุญ (ุฌุฏูุฏ)
$session = getOrCreateDailySession('daily_actions'); // ูุฑุฉ ูุงุญุฏุฉ!
foreach ($actions as $action) {
    create(['session_id' => $session->id]);
}
```

### โ ุฎุทุฃ 3: ุงุณุชุฎุฏุงู batch ููุฅุฌุฑุงุกุงุช
```php
// โ ุฎุทุฃ
$batch = createBatch(['batch_type' => 'actions']); // ูุง!
```

```php
// โ ุตุญูุญ
$session = getOrCreateDailySession('daily_actions'); // ูุนู!
```

---

## ๐ Quick Reference

### ูุชู ุชุณุชุฎุฏู Sessionุ
- โ ุนูุฏ ุฅูุดุงุก **ุชูุฏูุฏ**
- โ ุนูุฏ ุฅุตุฏุงุฑ **ุฅูุฑุงุฌ**
- โ ุนูุฏ ุนูู **ุชุนุฏูู** ุนูู ุถูุงู
- โ ุฃู **ุฅุฌุฑุงุก** ูุชู ูู ุฏุงุฎู ุงููุธุงู

### ูุชู ุชุณุชุฎุฏู Batchุ
- โ ุนูุฏ ุงุณุชูุฑุงุฏ **ููู Excel**
- โ ุนูุฏ **ุฅุฏุฎุงู ูุฏูู** ูุณุฌูุงุช ุฌุฏูุฏุฉ
- โ ุนูุฏ **ูุตู ูุต** ูู ูุตุฏุฑ ุฎุงุฑุฌู
- โ ุฃู **ุงุณุชูุฑุงุฏ** ูู ุฎุงุฑุฌ ุงููุธุงู

---

## ๐ง ุงููููุงุช ุฐุงุช ุงูุตูุฉ

### Sessions
- `app/Repositories/ImportSessionRepository.php` - ุฅุฏุงุฑุฉ ุงูุฌูุณุงุช
- `app/Models/ImportSession.php` - ูููุฐุฌ ุงูุฌูุณุฉ
- `www/api/issue-extension.php` - ูุซุงู ุงุณุชุฎุฏุงู
- `www/api/issue-release.php` - ูุซุงู ุงุณุชุฎุฏุงู

### Batches
- `app/Repositories/ImportBatchRepository.php` - ุฅุฏุงุฑุฉ ุงููุฌููุนุงุช
- `app/Repositories/GuaranteeRepository.php` - ุงุณุชุฎุฏุงู import_batch_id
- `app/Adapters/GuaranteeDataAdapter.php` - dual-write logic

---

## ๐ ูููุทูุฑูู ุงูุฌุฏุฏ

ุฅุฐุง ููุช ุบูุฑ ูุชุฃูุฏ ุฃูููุง ุชุณุชุฎุฏูุ ุงุณุฃู ููุณู:

**โ ูู ูุฐุง ุฅุฌุฑุงุก ุนูู ุถูุงู ููุฌูุฏุ**
โ ุงุณุชุฎุฏู **Session**

**โ ูู ูุฐุง ุงุณุชูุฑุงุฏ ุจูุงูุงุช ุฌุฏูุฏุฉุ**
โ ุงุณุชุฎุฏู **Batch**

**ุงููุงุนุฏุฉ ุงูุฐูุจูุฉ:**
- **Actions** โ Sessions
- **Imports** โ Batches

---

## ๐ ุชุงุฑูุฎ ุงูุชุญุฏูุซุงุช

| ุงูุชุงุฑูุฎ | ุงูุชุบููุฑ | Commit |
|---------|---------|--------|
| 2025-12-20 | ุฅุถุงูุฉ ูุธุงู ุงูุฌูุณุฉ ุงูููููุฉ ููุฅุฌุฑุงุกุงุช | `ea10f16` |
| 2025-12-20 | ุฅูุดุงุก ูุฐุง ุงูุชูุซูู | - |

---

**ููุฃุณุฆูุฉ ุฃู ุงูุชูุถูุญุงุชุ ุฑุงุฌุน:**
- `brainstorming.md` - ุงูุชุญููู ุงูุฃููู
- `implementation_plan.md` - ุฎุทุฉ ุงูุชูููุฐ ุงููุงููุฉ
- `walkthrough.md` - ููุฎุต ุงูุฅุตูุงุญุงุช
