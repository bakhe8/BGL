# 03 - محرك المطابقة (Matching Engine)

يشرح هذا المستند كيف "يفكر" النظام عند مطابقة الأسماء.

## 1. آلية المطابقة (Mechanism)
يتم حساب درجة تشابه (Score) بين النص المدخل في Excel وبين قاعدة البيانات (0.0 إلى 1.0).

### العوامل المؤثرة:
1. **Official Match (الاسم الرسمي)**: تطابق تام مع الاسم المسجل. (الوزن الافتراضي: 1.0)
2. **Alias Match (اسم بديل)**: تطابق مع اسم "شهر" أو "بديل" تم حفظه سابقاً.
   - مؤكد يدوياً: وزن 0.95
   - تعلم آلي: وزن 0.75
3. **Fuzzy Match (مطابقة تقريبية)**: استخدام خوارزمية Levenshtein لتجاوز الأخطاء الإملائية. (الوزن: 0.80)

### تنويه هام: الفرق بين المورد والبنك
| الميزة | المورد (Supplier) | البنك (Bank) |
| :--- | :--- | :--- |
| **مصدر المطابقة** | الاسم الرسمي + جدول الأسماء البديلة (`aliases`) | الاسم الرسمي (عربي/إنجليزي) + الرمز المختصر (`short_code`) |
| **اللغة** | عربي بشكل أساسي (إلا إذا تم تعليم اسم إنجليزي كبديل) | ثنائي اللغة (Native Support) |
| **الرموز** | لا يوجد | يدعم الرموز البنكية (مثل SNB, SAB) |
| **التعلم** | يعتمد كلياً على إضافة Aliases | يعتمد على Aliases فقط في الحالات النادرة |

## 2. حالات المطابقة (Status)
- **Ready**:
  - تم العثور على مورد (Supplier) بدرجة ثقة > 0.90 (Match Auto Threshold).
  - تم العثور على بنك (Bank) بدرجة ثقة > 0.90.
  - لا يوجد تعارض (Conflict) مع نتائج أخرى قريبة.
- **Needs Review**:
  - الدرجة أقل من 0.90.
  - أو يوجد أكثر من نتيجة قوية متقاربة جداً (Conflict).
  - أو أحد الطرفين (المورد أو البنك) غير معروف.

## 3. التعلم (Learning)
عندما تقوم باختيار مورد يدوياً لسجل كان "غير معروف":
1. يقوم النظام بحفظ النص المدخل كـ "اسم بديل" (Alias) لهذا المورد.
2. في المرة القادمة، سيتم التعرف عليه تلقائياً.
